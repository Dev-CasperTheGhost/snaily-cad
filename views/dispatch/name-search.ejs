<%- include("../partials/header.ejs") %>

<div class="container mt-2">

    <% if (result) { %>
    <h1 class="card-title cap text-light">Dispatch -  <%= result.full_name %> </h1>
    <div class="users-list">

        <ul class="list-group">
            <a href="/cad/<%= cadId %>/dispatch" class="btn btn-primary cap">Back to Dispatch</a>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Full Name: <%= result.full_name %> </li>
            <!-- <li class="list-group-item">Last Name: <%= result.last_name %></li> -->
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Gender: <%= result.gender %></li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Birthday: <%= result.birth %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Ethnicity: <%= result.ethnicity %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Hair Color: <%= result.hair %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Eye Color: <%= result.eyes %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Address: <%= result.address %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Height: <%= result.height %> </li>
            <li class="list-group-item bg-dark border-dark mt-1 text-light cap">Weight: <%= result.weight %> </li>
            <% if (result.business === "Currently is not working") { %>
                <li class="list-group-item bg-dark text-light  mt-1 cap">Employer: Currently is not working</li>
                <%} else {%>
                <li class="list-group-item bg-dark text-light  mt-1 cap">Employer: <a href="/cad/<%= cadId %>/citizen/company/<%= result.business %>"> <%= result.business %></a> </li>
    
                <%} %>

            <div class="list-group-item list-group-item-action active bg-dark border-dark mt-1 text-light">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">Licences:</h5>
                </div>
                <div id="dots3"></div>
                <div id="more3">
                    <p class="mb-1">
                        <li class="list-group-item color-black cap"><span class="bolder">Driver License:</span>  <%= result.dmv %> </li>
                        <li class="list-group-item color-black cap"><span class="bolder">Pilot License: </span> <%= result.pilot_licence %> </li>
                        <li class="list-group-item color-black cap"><span class="bolder"> Firearms License: </span> <%= result.fire_licence %> </li>
                        <li class="list-group-item color-black cap"><span class="bolder"> CCW License:</span> <%= result.ccw %> </li>
                    </p>

                </div>
                <button class="btn btn-primary" onclick="lic()" id="licBtn">See all</button>



            </div>
            <div class="list-group-item list-group-item-action active bg-dark border-dark mt-1 text-light">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">Vehicles:</h5>
                </div>
                <div id="dots"></div>
                <div id="more">
                    <% if (vehicles[0]) { %>
                        <p class="mb-1">
                            <% vehicles.forEach(vehicle => { %>
                            <li class="list-group-item color-black"> <%= vehicle.vehicle %> <br>
                                <span class="font-weight-bold cap"> Plate:</span> <span class="uppercase font-weight-normal"><%= vehicle.plate %></span> <br> 
                                <span class="font-weight-bold cap">Insurance Status:</span>  <span> <%= vehicle.in_status %></span> <br>
                                <span class="font-weight-bold cap">Color:</span>  <span class="cap"> <%= vehicle.color %></span> <br>
                                <span class="font-weight-bold cap">VIN:</span>  <span class="cap"> <%= vehicle.vin_number %></span> <br>
                            
                            </li>
                            <% }) %>
                        </p>
                    <% } else {%>
                        <p class="mb-1">
                            <li class="list-group-item text-dark">
                                This Person doesn't have any cars registered
                            </li>
                        </p>
                        <%} %>
                </div>
                <button class="btn btn-primary" onclick="veh()" id="vehBtn">See all</button>


            </div>
            <div class="list-group-item list-group-item-action active bg-dark border-dark mt-1 text-light">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">Weapons:</h5>
                </div>
                <div id="dots2"></div>
                <div id="more2">
                    <% if (!weapons[0]) { %>
                    <li class="list-group-item color-black">
                        <p>No Weapons registered to this person.</p>
                    </li>
                    <% } else  {%>
                    <p class="mb-1">
                        <% weapons.forEach(weapon => { %>
                            <li class="list-group-item color-black"> <%= weapon.weapon %> <br>
                                <span class="font-weight-bold">Serial Number:</span>  <%= weapon.serial_number %> <br/>
                                <span class="font-weight-bold">weapon Status:</span>  <%= weapon.status %> <br>
                            </li>
                        <%  }) %>
                    </p>

                    <% } %>
                </div>
                <div class="btn btn-primary mt-1 pointer" onclick="wep()" id="weapenBtn">See all</button>
                </div>


            </div>



            <!-- Charges -->
            <div class="list-group-item list-group-item-action active bg-dark border-dark mt-1 text-light">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">Legal:</h5>
                </div>
                <div id="dots4"></div>
                <div id="more4">
                    <% if (!charges[0]) { %>
                    <li class="list-group-item color-black">
                        <p>Clean record.</p>
                        <a class="btn btn-primary"
                            href="/cad/<%= cadId %>/officers/dash/offence/add/<%= result.id %>-<%= result.first_name %>-<%= result.last_name %>">Add
                            Offence</a>
                    </li>
                    <% } else  {%>
                    <p class="mb-1">
                        <% charges.forEach(charge => { %>
                            <li class="list-group-item color-black"> <%= charge.charge %> <br>
                                <span class="bolder">Notes: </span> <%= charge.notes %> <br> <span class="bolder">Given on:</span>  <%= charge.date %> <br> <span class="bolder">Nearest Postal: </span> <%= charge.postal %>
        
                            </li>
                        <%  }) %>
                        </t_name>
                        <% } %>
                        <a class="btn btn-primary mt-1"
                            href="/cad/<%= cadId %>/officers/dash/offence/add/<%= result.id %>-<%= result.first_name %>-<%= result.last_name %>">Add
                            Offence</a>
                </div>
                <div class="btn btn-primary mt-1 pointer" onclick="legal()" id="legalBtn">See all</button>


                </div>
        </ul>
        <div class="mb-4"></div>
    </div>
    <% } else { %>
    <p class="text-center text-light">Citizen Not Found. Go Back <a href="/cad/<%= cadId %>/dispatch">Here</a>.</p>

    <% } %>

</div>

<script>
    function veh() {
        let dots = document.getElementById("dots");
        let moreText = document.getElementById("more");
        let vehBtn = document.getElementById("vehBtn")
        let weapenBtn = document.getElementById("weapenBtn")

        if (dots.style.display === "none") {
            dots.style.display = "inline";
            moreText.style.display = "none";
            vehBtn.textContent = "See All"

        } else {
            dots.style.display = "none";
            moreText.style.display = "inline";
            vehBtn.textContent = "See Less"
        }
    }
    function wep() {
        let dots = document.getElementById("dots2");
        let moreText = document.getElementById("more2");
        let vehBtn = document.getElementById("vehBtn")
        let weapenBtn = document.getElementById("weapenBtn")

        if (dots.style.display === "none") {
            dots.style.display = "inline";
            moreText.style.display = "none";
            weapenBtn.textContent = "See All"
        } else {
            dots.style.display = "none";
            moreText.style.display = "inline";
            weapenBtn.textContent = "See Less"
        }
    }
    function lic() {
        let dots = document.getElementById("dots3");
        let moreText = document.getElementById("more3");
        let vehBtn = document.getElementById("vehBtn")
        let weapenBtn = document.getElementById("weapenBtn")
        let licBtn = document.getElementById("licBtn")

        if (dots.style.display === "none") {
            dots.style.display = "inline";
            moreText.style.display = "none";
            licBtn.textContent = "See All"
        } else {
            dots.style.display = "none";
            moreText.style.display = "inline";
            licBtn.textContent = "See Less"
        }
    }
    function legal() {
        let dots = document.getElementById("dots4");
        let moreText = document.getElementById("more4");
        let vehBtn = document.getElementById("vehBtn")
        let weapenBtn = document.getElementById("weapenBtn")
        let licBtn = document.getElementById("licBtn")
        let legalBtn = document.getElementById("legalBtn")

        if (dots.style.display === "none") {
            dots.style.display = "inline";
            moreText.style.display = "none";
            legalBtn.textContent = "See All"
        } else {
            dots.style.display = "none";
            moreText.style.display = "inline";
            legalBtn.textContent = "See Less"
        }
    }
</script>